/**********************************************************************************************************************
 *  GENIS KOREA SOFTWARE
 *  -------------------------------------------------------------------------------------------------------------------
 *  Copyright (c) 2019-2024 GENIS KOREA Inc.                                                 All rights reserved.
 *
 *                This software is copyright protected and proprietary to GENIS KOREA.
 *                Restricted Distribution:
 *                  Not to be distributed This source code to anyone without the approval from GENIS KOREA.
 *
 *  -------------------------------------------------------------------------------------------------------------------
 *  DESCRIPTION
 *  -------------------------------------------------------------------------------------------------------------------
 *  Filename: CANController.c
 *  Created: May 9, 2025
 *  Author: yeo
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "CANController.h"
#include "../Genis/Charger/User_Impl.h"
#include "../Genis/Charger/Charger.h"
#include "../Driver/CAN.h"
/**********************************************************************************************************************
 *  LOCAL CONSTANT MACROS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA TYPES AND STRUCTURES
 *********************************************************************************************************************/
//#pragma pack(push,1)
//#pragma pack(pop)
/**********************************************************************************************************************
 *  LOCAL DATA PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION MACROS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/
void CAN_Controller_MainFunction(void)
{
  if(CanRxFlag)
  {
    CanRxFlag = 0;
    if(CanRxHeader.IdType == FDCAN_STANDARD_ID)
    {
      printf("H743_Mode : CAN_TEST_MODE, RX, std_id : %03lX   %02X %02X %02X %02X %02X %02X %02X %02X \r\n",
          (uint16_t)CanRxHeader.Identifier,CanRxData[0],
          CanRxData[1],CanRxData[2],CanRxData[3],CanRxData[4],
          CanRxData[5],CanRxData[6],CanRxData[7]);
    }
    else
    {
      printf("H743_Mode : CAN_TEST_MODE, RX, ext_id : %08lX  %02X %02X %02X %02X %02X %02X %02X %02X \r\n",
          (uint16_t)CanRxHeader.Identifier,CanRxData[0],
          CanRxData[1],CanRxData[2],CanRxData[3],CanRxData[4],
          CanRxData[5],CanRxData[6],CanRxData[7]);
    }
  }
}

void App_CanRxMainFunction(GenisCsm_ChargerType *Charger)
{
  while(TRUE)
  {
//    Can_DataType CanData;
    uint8 CanData[8];
    if(xQueueReceive(App_CanRxQueue, CanData,1000) == pdPASS)
    {
      printf("CAN_RxData : %02X %02X %02X %02X %02X %02X %02X %02X \r\n",
//          CanData.Data[0],CanData.Data[1],CanData.Data[2],CanData.Data[3],
//          CanData.Data[4],CanData.Data[5],CanData.Data[6],CanData.Data[7]);
          CanData[0],CanData[1],CanData[2],CanData[3],
          CanData[4],CanData[5],CanData[6],CanData[7]);
    }
    Delay(100);
  }
}

void App_CanTxMainFunction(GenisCsm_ChargerType *Charger)
{
  while(TRUE)
  {
    uint8 data[8] = {0};

    CAN_Tx(data);
    Delay(100);
  }
}

